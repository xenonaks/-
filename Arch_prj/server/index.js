import express from 'express'
import cors from 'cors'

const app = express()
const PORT = 5000

app.use(cors())
app.use(express.json())

// In-memory storage (Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð‘Ð”)
let users = []
let tours = [
  {
    id: 1,
    title: 'ÐžÑ‚Ð´Ñ‹Ñ… Ð½Ð° Ð‘Ð°Ð»Ð¸',
    description: 'ÐÐµÐ·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ‚Ð´Ñ‹Ñ… Ð½Ð° Ñ‚Ñ€Ð¾Ð¿Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ Ð¾ÑÑ‚Ñ€Ð¾Ð²Ðµ Ð‘Ð°Ð»Ð¸. Ð‘ÐµÐ»Ð¾ÑÐ½ÐµÐ¶Ð½Ñ‹Ðµ Ð¿Ð»ÑÐ¶Ð¸, ÐºÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾ Ñ‡Ð¸ÑÑ‚Ð°Ñ Ð²Ð¾Ð´Ð° Ð¸ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð° Ð¶Ð´ÑƒÑ‚ Ð²Ð°Ñ.',
    location: 'Ð‘Ð°Ð»Ð¸, Ð˜Ð½Ð´Ð¾Ð½ÐµÐ·Ð¸Ñ',
    price: 89000,
    duration: 7,
    maxPeople: 4,
    image: 'https://images.unsplash.com/photo-1518548419970-58e3b4079ab2?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1: ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð² Ð¾Ñ‚ÐµÐ»Ðµ',
      'Ð”ÐµÐ½ÑŒ 2: Ð­ÐºÑÐºÑƒÑ€ÑÐ¸Ñ Ð¿Ð¾ Ñ…Ñ€Ð°Ð¼Ð°Ð¼ Ð£Ð±ÑƒÐ´Ð°',
      'Ð”ÐµÐ½ÑŒ 3: ÐŸÐ»ÑÐ¶Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð´Ñ‹Ñ… Ð¸ Ð´Ð°Ð¹Ð²Ð¸Ð½Ð³',
      'Ð”ÐµÐ½ÑŒ 4: ÐŸÐ¾ÑÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ€Ð¸ÑÐ¾Ð²Ñ‹Ñ… Ñ‚ÐµÑ€Ñ€Ð°Ñ',
      'Ð”ÐµÐ½ÑŒ 5: Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ',
      'Ð”ÐµÐ½ÑŒ 6: Ð’Ð¾Ð´Ð¾Ð¿Ð°Ð´ Ð¸ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð½Ñ‹Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸',
      'Ð”ÐµÐ½ÑŒ 7: ÐžÑ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'ÐŸÑ€Ð¾Ð¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð² 4* Ð¾Ñ‚ÐµÐ»Ðµ',
      'Ð—Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ¸',
      'Ð¢Ñ€Ð°Ð½ÑÑ„ÐµÑ€ Ð¸Ð· Ð°ÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚Ð°',
      'ÐœÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ°Ñ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ð²ÐºÐ°'
    ]
  },
  {
    id: 2,
    title: 'ÐŸÐ°Ñ€Ð¸Ð¶ Ñ€Ð¾Ð¼Ð°Ð½Ñ‚Ð¸Ñ‡Ð½Ñ‹Ð¹',
    description: 'Ð Ð¾Ð¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿ÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ðµ Ð² ÑÑ‚Ð¾Ð»Ð¸Ñ†Ñƒ Ð¤Ñ€Ð°Ð½Ñ†Ð¸Ð¸. Ð­Ð¹Ñ„ÐµÐ»ÐµÐ²Ð° Ð±Ð°ÑˆÐ½Ñ, Ð›ÑƒÐ²Ñ€, ÐœÐ¾Ð½Ð¼Ð°Ñ€Ñ‚Ñ€ Ð¸ Ð¸Ð·Ñ‹ÑÐºÐ°Ð½Ð½Ð°Ñ Ñ„Ñ€Ð°Ð½Ñ†ÑƒÐ·ÑÐºÐ°Ñ ÐºÑƒÑ…Ð½Ñ.',
    location: 'ÐŸÐ°Ñ€Ð¸Ð¶, Ð¤Ñ€Ð°Ð½Ñ†Ð¸Ñ',
    price: 125000,
    duration: 5,
    maxPeople: 2,
    image: 'https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1: ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ, Ð¾Ð±Ð·Ð¾Ñ€Ð½Ð°Ñ ÑÐºÑÐºÑƒÑ€ÑÐ¸Ñ',
      'Ð”ÐµÐ½ÑŒ 2: Ð›ÑƒÐ²Ñ€ Ð¸ Ð•Ð»Ð¸ÑÐµÐ¹ÑÐºÐ¸Ðµ Ð¿Ð¾Ð»Ñ',
      'Ð”ÐµÐ½ÑŒ 3: Ð­Ð¹Ñ„ÐµÐ»ÐµÐ²Ð° Ð±Ð°ÑˆÐ½Ñ Ð¸ Ð¡ÐµÐ½Ð°',
      'Ð”ÐµÐ½ÑŒ 4: Ð’ÐµÑ€ÑÐ°Ð»ÑŒ',
      'Ð”ÐµÐ½ÑŒ 5: ÐœÐ¾Ð½Ð¼Ð°Ñ€Ñ‚Ñ€ Ð¸ Ð¾Ñ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'ÐŸÑ€Ð¾Ð¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ ÐŸÐ°Ñ€Ð¸Ð¶Ð°',
      'Ð—Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ¸',
      'ÐœÐµÑ‚Ñ€Ð¾-Ð¿Ð°ÑÑ',
      'Ð­ÐºÑÐºÑƒÑ€ÑÐ¸Ð¸ Ñ Ð³Ð¸Ð´Ð¾Ð¼'
    ]
  },
  {
    id: 3,
    title: 'Ð¡Ð°Ñ„Ð°Ñ€Ð¸ Ð² ÐšÐµÐ½Ð¸Ð¸',
    description: 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ°Ñ„Ð°Ñ€Ð¸ Ð¿Ð¾ Ð½Ð°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¿Ð°Ñ€ÐºÐ°Ð¼ ÐšÐµÐ½Ð¸Ð¸. Ð‘Ð»Ð¸Ð·ÐºÐ¸Ðµ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð¸ Ñ Ð´Ð¸ÐºÐ¸Ð¼Ð¸ Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ñ‹Ð¼Ð¸ Ð¸ Ð½ÐµÐ·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð¿ÐµÐ¹Ð·Ð°Ð¶Ð¸ Ð°Ñ„Ñ€Ð¸ÐºÐ°Ð½ÑÐºÐ¾Ð¹ ÑÐ°Ð²Ð°Ð½Ð½Ñ‹.',
    location: 'ÐÐ°Ð¹Ñ€Ð¾Ð±Ð¸, ÐšÐµÐ½Ð¸Ñ',
    price: 145000,
    duration: 8,
    maxPeople: 6,
    image: 'https://images.unsplash.com/photo-1516426122078-c23e76319801?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1: ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ Ð² ÐÐ°Ð¹Ñ€Ð¾Ð±Ð¸',
      'Ð”ÐµÐ½ÑŒ 2-3: ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð°Ñ€Ðº ÐœÐ°ÑÐ°Ð¸-ÐœÐ°Ñ€Ð°',
      'Ð”ÐµÐ½ÑŒ 4: ÐžÐ·ÐµÑ€Ð¾ ÐÐ°ÐºÑƒÑ€Ñƒ',
      'Ð”ÐµÐ½ÑŒ 5-6: ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð°Ñ€Ðº ÐÐ¼Ð±Ð¾ÑÐµÐ»Ð¸',
      'Ð”ÐµÐ½ÑŒ 7: Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð² ÐÐ°Ð¹Ñ€Ð¾Ð±Ð¸',
      'Ð”ÐµÐ½ÑŒ 8: ÐžÑ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð² Ð»Ð¾Ð´Ð¶Ð°Ñ…',
      'ÐŸÐ¸Ñ‚Ð°Ð½Ð¸Ðµ (Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿Ð°Ð½ÑÐ¸Ð¾Ð½)',
      'Ð¡Ð°Ñ„Ð°Ñ€Ð¸-Ñ‚ÑƒÑ€Ñ‹',
      'ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ð¸Ð´'
    ]
  },
  {
    id: 4,
    title: 'Ð¯Ð¿Ð¾Ð½Ð¸Ñ: Ð¢Ð¾ÐºÐ¸Ð¾ Ð¸ ÐšÐ¸Ð¾Ñ‚Ð¾',
    description: 'ÐŸÐ¾Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð² ÐºÑƒÐ»ÑŒÑ‚ÑƒÑ€Ñƒ Ð¸ Ñ‚Ñ€Ð°Ð´Ð¸Ñ†Ð¸Ð¸ Ð¯Ð¿Ð¾Ð½Ð¸Ð¸. Ð¡Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ð¢Ð¾ÐºÐ¸Ð¾ Ð¸ Ð´Ñ€ÐµÐ²Ð½Ð¸Ð¹ ÐšÐ¸Ð¾Ñ‚Ð¾, Ñ…Ñ€Ð°Ð¼Ñ‹, ÑÐ°Ð´Ñ‹ Ð¸ ÑÐ¿Ð¾Ð½ÑÐºÐ°Ñ ÐºÑƒÑ…Ð½Ñ.',
    location: 'Ð¢Ð¾ÐºÐ¸Ð¾, Ð¯Ð¿Ð¾Ð½Ð¸Ñ',
    price: 165000,
    duration: 10,
    maxPeople: 4,
    image: 'https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1-3: Ð¢Ð¾ÐºÐ¸Ð¾ - ÑÐºÑÐºÑƒÑ€ÑÐ¸Ð¸ Ð¿Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ñƒ',
      'Ð”ÐµÐ½ÑŒ 4: ÐŸÐµÑ€ÐµÐµÐ·Ð´ Ð² ÐšÐ¸Ð¾Ñ‚Ð¾ Ð½Ð° ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð½Ð¾Ð¼ Ð¿Ð¾ÐµÐ·Ð´Ðµ',
      'Ð”ÐµÐ½ÑŒ 5-7: ÐšÐ¸Ð¾Ñ‚Ð¾ - Ñ…Ñ€Ð°Ð¼Ñ‹ Ð¸ ÑÐ°Ð´Ñ‹',
      'Ð”ÐµÐ½ÑŒ 8: ÐÐ°Ñ€Ð° - Ð´Ñ€ÐµÐ²Ð½ÑÑ ÑÑ‚Ð¾Ð»Ð¸Ñ†Ð°',
      'Ð”ÐµÐ½ÑŒ 9: Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¢Ð¾ÐºÐ¸Ð¾',
      'Ð”ÐµÐ½ÑŒ 10: ÐžÑ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'ÐŸÑ€Ð¾Ð¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð² Ð¾Ñ‚ÐµÐ»ÑÑ…',
      'Ð—Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ¸',
      'JR Pass',
      'Ð­ÐºÑÐºÑƒÑ€ÑÐ¸Ð¸ Ñ Ñ€ÑƒÑÑÐºÐ¾ÑÐ·Ñ‹Ñ‡Ð½Ñ‹Ð¼ Ð³Ð¸Ð´Ð¾Ð¼'
    ]
  },
  {
    id: 5,
    title: 'ÐœÐ°Ð»ÑŒÐ´Ð¸Ð²Ñ‹ - Ñ€Ð°Ð¹ Ð½Ð° Ð·ÐµÐ¼Ð»Ðµ',
    description: 'Ð Ð¾ÑÐºÐ¾ÑˆÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð´Ñ‹Ñ… Ð½Ð° ÐœÐ°Ð»ÑŒÐ´Ð¸Ð²Ð°Ñ…. Ð’Ð¸Ð»Ð»Ñ‹ Ð½Ð°Ð´ Ð²Ð¾Ð´Ð¾Ð¹, Ð¿Ð¾Ð´Ð²Ð¾Ð´Ð½Ñ‹Ð¹ Ð¼Ð¸Ñ€, ÑÐ¿Ð°-Ð¿Ñ€Ð¾Ñ†ÐµÐ´ÑƒÑ€Ñ‹ Ð¸ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ€ÐµÐ»Ð°ÐºÑ.',
    location: 'ÐœÐ°Ð»ÑŒÐ´Ð¸Ð²Ñ‹',
    price: 220000,
    duration: 7,
    maxPeople: 2,
    image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1: ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ, Ñ‚Ñ€Ð°Ð½ÑÑ„ÐµÑ€ Ð½Ð° Ð²Ð¾Ð´Ð½Ð¾Ð¼ ÑÐ°Ð¼Ð¾Ð»ÐµÑ‚Ðµ',
      'Ð”ÐµÐ½ÑŒ 2-6: ÐžÑ‚Ð´Ñ‹Ñ…, Ð´Ð°Ð¹Ð²Ð¸Ð½Ð³, ÑÐ¿Ð°',
      'Ð”ÐµÐ½ÑŒ 7: ÐžÑ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'Ð’Ð¸Ð»Ð»Ð° Ð½Ð°Ð´ Ð²Ð¾Ð´Ð¾Ð¹',
      'Ð’ÑÑ‘ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾',
      'Ð”Ð°Ð¹Ð²Ð¸Ð½Ð³ Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ',
      'Ð¡Ð¿Ð°-Ð¿Ñ€Ð¾Ñ†ÐµÐ´ÑƒÑ€Ñ‹'
    ]
  },
  {
    id: 6,
    title: 'Ð˜ÑÐ»Ð°Ð½Ð´Ð¸Ñ - ÑÑ‚Ñ€Ð°Ð½Ð° Ð¾Ð³Ð½Ñ Ð¸ Ð»ÑŒÐ´Ð°',
    description: 'ÐŸÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ðµ Ð¿Ð¾ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð˜ÑÐ»Ð°Ð½Ð´Ð¸Ð¸. Ð“ÐµÐ¹Ð·ÐµÑ€Ñ‹, Ð²Ð¾Ð´Ð¾Ð¿Ð°Ð´Ñ‹, Ð»ÐµÐ´Ð½Ð¸ÐºÐ¸ Ð¸ ÑÐµÐ²ÐµÑ€Ð½Ð¾Ðµ ÑÐ¸ÑÐ½Ð¸Ðµ Ð² Ð·Ð¸Ð¼Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´.',
    location: 'Ð ÐµÐ¹ÐºÑŒÑÐ²Ð¸Ðº, Ð˜ÑÐ»Ð°Ð½Ð´Ð¸Ñ',
    price: 135000,
    duration: 7,
    maxPeople: 8,
    image: 'https://images.unsplash.com/photo-1531572753322-ad063cecc140?w=800',
    itinerary: [
      'Ð”ÐµÐ½ÑŒ 1: ÐŸÑ€Ð¸Ð±Ñ‹Ñ‚Ð¸Ðµ Ð² Ð ÐµÐ¹ÐºÑŒÑÐ²Ð¸Ðº',
      'Ð”ÐµÐ½ÑŒ 2: Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð¾',
      'Ð”ÐµÐ½ÑŒ 3: Ð®Ð¶Ð½Ð¾Ðµ Ð¿Ð¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ',
      'Ð”ÐµÐ½ÑŒ 4: Ð›ÐµÐ´Ð½Ð¸ÐºÐ¾Ð²Ð°Ñ Ð»Ð°Ð³ÑƒÐ½Ð°',
      'Ð”ÐµÐ½ÑŒ 5: Ð“Ð¾Ð»ÑƒÐ±Ð°Ñ Ð»Ð°Ð³ÑƒÐ½Ð°',
      'Ð”ÐµÐ½ÑŒ 6: ÐÐ°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ Ð·Ð° ÑÐµÐ²ÐµÑ€Ð½Ñ‹Ð¼ ÑÐ¸ÑÐ½Ð¸ÐµÐ¼',
      'Ð”ÐµÐ½ÑŒ 7: ÐžÑ‚ÑŠÐµÐ·Ð´'
    ],
    includes: [
      'ÐŸÐµÑ€ÐµÐ»ÐµÑ‚',
      'ÐŸÑ€Ð¾Ð¶Ð¸Ð²Ð°Ð½Ð¸Ðµ',
      'Ð—Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ¸',
      'ÐÐ²Ñ‚Ð¾Ð±ÑƒÑÐ½Ñ‹Ðµ ÑÐºÑÐºÑƒÑ€ÑÐ¸Ð¸',
      'Ð’Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð±Ð¸Ð»ÐµÑ‚Ñ‹'
    ]
  }
]

// Middleware Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization']
  const token = authHeader && authHeader.split(' ')[1]

  if (!token) {
    return res.status(401).json({ message: 'Ð¢Ð¾ÐºÐµÐ½ Ð½Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½' })
  }

  // ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¾ÐºÐµÐ½Ð° (Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ JWT)
  const user = users.find(u => u.token === token)
  if (!user) {
    return res.status(403).json({ message: 'ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½' })
  }

  req.user = user
  next()
}

// Auth Routes
app.post('/api/auth/register', (req, res) => {
  const { name, email, password } = req.body

  if (!name || !email || !password) {
    return res.status(400).json({ message: 'Ð’ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹' })
  }

  if (users.find(u => u.email === email)) {
    return res.status(400).json({ message: 'ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ñ Ñ‚Ð°ÐºÐ¸Ð¼ email ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚' })
  }

  const user = {
    id: users.length + 1,
    name,
    email,
    password, // Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ñ…ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
    token: `token_${Date.now()}_${Math.random()}`,
    createdAt: new Date().toISOString()
  }

  users.push(user)
  res.status(201).json({
    token: user.token,
    user: {
      id: user.id,
      name: user.name,
      email: user.email,
      createdAt: user.createdAt
    }
  })
})

app.post('/api/auth/login', (req, res) => {
  const { email, password } = req.body

  const user = users.find(u => u.email === email && u.password === password)

  if (!user) {
    return res.status(401).json({ message: 'ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ email Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ' })
  }

  res.json({
    token: user.token,
    user: {
      id: user.id,
      name: user.name,
      email: user.email,
      createdAt: user.createdAt
    }
  })
})

// Tours Routes
app.get('/api/tours', (req, res) => {
  res.json(tours)
})

app.get('/api/tours/:id', (req, res) => {
  const tour = tours.find(t => t.id === parseInt(req.params.id))

  if (!tour) {
    return res.status(404).json({ message: 'Ð¢ÑƒÑ€ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½' })
  }

  res.json(tour)
})

app.listen(PORT, () => {
  console.log(`ðŸš€ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° http://localhost:${PORT}`)
})

